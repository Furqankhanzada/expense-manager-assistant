version: '3.8'

# Coolify / Cloud deployment
# Environment variables are configured in Coolify UI and referenced here.
# Variables marked with :? are required and deployment will fail if not set.

services:
  bot:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      # Required - deployment fails if not set in Coolify UI
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:?}
      - DATABASE_URL=${DATABASE_URL:?}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:?}

      # LLM Configuration
      - DEFAULT_LLM_PROVIDER=${DEFAULT_LLM_PROVIDER:-openai}
      - DEFAULT_LLM_MODEL=${DEFAULT_LLM_MODEL:-gpt-4o-mini}

      # API Keys (set the one you're using)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY:-}
      - XAI_API_KEY=${XAI_API_KEY:-}

      # Optional settings
      - WHISPER_MODEL=${WHISPER_MODEL:-base}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
    volumes:
      - bot-data:/app/data
    healthcheck:
      test: ["CMD", "python", "-c", "print('healthy')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  bot-data:
